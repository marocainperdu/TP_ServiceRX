# Squid Proxy Configuration pour Campus

# Port d'écoute
http_port 3128

# Nom du cache
visible_hostname campus-proxy

# Taille du cache
cache_dir ufs /var/spool/squid 10000 16 256
maximum_object_size 512 MB
cache_mem 256 MB

# ACLs - Contrôle d'accès
acl localnet src 172.20.0.0/16
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

# Sites éducatifs prioritaires (mise en cache)
acl education_sites dstdomain .edu .ac.uk .education
acl package_repos dstdomain .ubuntu.com .debian.org .centos.org

# Règles d'accès
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access deny all

# Optimisation du cache
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern \.(jpg|png|gif|mp3|mp4|pdf|zip|tar|gz|iso)$ 10080 90% 43200 override-expire ignore-reload
refresh_pattern .               0       20%     4320

# Cache pour les paquets (Ubuntu, Debian, etc.)
refresh_pattern deb$   129600 100% 129600
refresh_pattern udeb$  129600 100% 129600
refresh_pattern tar.gz$  129600 100% 129600
refresh_pattern .iso$  129600 100% 129600

# Logs
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
